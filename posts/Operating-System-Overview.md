---
title: Operating System Overview
date: 2023-01-23 15:47:00 +0900
categories: [OS]
tags: [os, system]
---

## 운영체제란?

유저와 컴퓨터 하드웨어 사이의 프로그램

**목표:**

1. 유저 프로그램 실행
2. 컴퓨터 시스템을 사용하기 편리하게 한다.
3. 컴퓨터 하드웨어를 효율적으로 사용한다.

**커널kernel** : 항상 실행되는 유일한 프로그램

**system program**

**미들웨어middleware** : 애플리케이션 개발자에게 추가적인 서비스를 제공하는 소프트웨어 프레임워크 (DB, multimedia, graphics)

## 컴퓨터 시스템의 구조

**컴퓨터 시스템의 4가지 요소**

1. 하드웨어 : CPU, memory, I/O devices
2. 운영체제 : 하드웨어 사용을 조정, 조절
3. 애플리케이션 프로그램 : 유저가 원하는 바에 따라 시스템 자원이 사용될 방법을 정의한다.
4. 유저 : 사람, 기계, 다른 컴퓨터들

**컴퓨터 시스템의 동작**

하드웨어끼리는 **버스bus**로 연결되어 있다.

메모리에 접근하기 위해 동시에 실행되고 있는 CPU(들)과 장치들이 경쟁한다.

**상세**

- 입출력 장치들과 CPU는 동시에 실행될 수 있다.
- 각각의 장치 종류를 담당하는 디바이스 컨트롤러라는 게 있다.
- 디바이스 컨트롤러에는 버퍼buffer가 있다.
- 각각의 디바이스 컨트롤러에 대해 운영체제의 디바이스 드라이버가 관리한다.
- CPU는 메인 메모리와 버퍼들 사이에서 데이터를 옮긴다.
- 입출력은 각 디바이스에서 로컬 버퍼 쪽으로 이루어진다.
- 디바이스 컨트롤러는 자신의 동작이 끝나면 CPU에게 **인터럽트interrupt**를 일으킴으로써 알린다.

**인터럽트**

- 인터럽트는 Interrupt vector을 참조하여 Interrupt Service Routine의 주소를 알고, 인터럽트 핸들러에게 컨트롤이 넘어간다.
- 인터럽트 아키텍쳐는 인터럽트된 instruction의 주소를 저장해두어야 한다.
- trap이나 exception은 소프트웨어에서 생성한 인터럽트. 에러 또는 운영체제 루틴을 호출하기 위해 발생.
- 운영체제는 인터럽트에 의해 동작한다.

**인터럽트 핸들링**

- 운영체제는 레지스터register와 프로그램 카운터program counter의 값을 저장해서 CPU의 상태를 보존한다.
- 인터럽트의 종류를 구별한다.
- 각각의 인터럽트에 대해 취해야 할 행동이 구별된 코드에 의해 정해진다.

**입출력 핸들링을 위해 두 가지 방법이 있을 수 있다**

- 입출력이 시작되면 입출력이 완료되어야만 유저 프로그램에게 컨트롤이 돌아올 수 있다.
    - 다음 인터럽트까지 CPU는 기다려야 한다.
    - Wait loop (contention for memory access) → 맥락을 아직 이해 못했음…
    - 하나의 입출력 요청만 기다릴 수 있다. 동시에 여러 입출력을 진행할 수 없다.
- 입출력이 시작되면 입출력이 완료되지 않아도 유저 프로그램에게 컨트롤이 돌아올 수 있다.
    - ******시스템 콜System call******: ************유저가 ************입출력이 끝나기를 기다리는 것을 운영체제에 요청한다.
    - **************************************************************Device status table************************************************************** 각각의 입출력 장치에 대해 종류와 주소, 상태를 저장한다.

## 저장 구조Storage Structure

- **메인 메모리**: CPU가 직접적으로 접근할 수 있는 유일한 저장 매체Storage media
    - Random-access memory in the form of Dynamic Random-access Memory (DRAM)
    - 휘발성volatile
- Secondary storage: extension of main memory that provides large nonvolatile storage capacity.
- 하드디스크 드라이브Hard Disk Drives (HDD): 자성 물질이 있는 알루미늄 혹은 유리 원판
    - 디스크 표면이 논리적으로 track으로 나누어져 있고, 각각은 섹터로 나누어져 있다.
- 비휘발성 메모리Non-volatile memory (NVM)
    - 하드디스크보다 빠르고, 비휘발성

### 저장 계층Storage Hierarchy

속도, 비용, 휘발성 유무에 따라 계층 구조를 나눈다.

- **캐싱Caching:** 더 빠른 저장 시스템에 정보를 복사해두는 것. 메인 메모리는 secondary storage(위에 나옴)의 캐시라고 볼 수도 있다.

![Operating System Concepts 10th](%E1%84%8B%E1%85%AE%E1%86%AB%E1%84%8B%E1%85%A7%E1%86%BC%E1%84%8E%E1%85%A6%E1%84%8C%E1%85%A6%20Overview%2082471d6dbb1a489b93fd99343dd1b350/Untitled.png)

Operating System Concepts 10th

## Direct Memory Access Structure

CPU를 거치지 않고, 장치 컨트롤러가 버퍼에서 메인 메모리로 직접적으로 데이터를 보낸다. 버스가 지원하는 기능이다.

DMA에 사용될 영역으로 메모리의 일정 부분이 지정된다.

CPU를 거치는 방식은 PIO(Programmed I/O)

CPU에서는 데이터 이동이 완료되었다는 인터럽트만 블럭 당 한 번 일어난다.

## 운영체제의 동작

1. **부트스트랩 프로그램Bootstrap program** : 시스템을 시작하고, 커널을 로드하는 간단한 코드
2. 커널 로드
3. **시스템 데몬System daemons** 실행 (커널 밖에서 제공되는 서비스들)
4. 커널 인터럽트에 의한 동작
    - 장치에 의한 하드웨어 인터럽트
    - 소프트웨어 인터럽트(trap이나 exception)
        - 소프트웨어 에러 (division by zero)
        - 운영체제 서비스 호출 (시스템 콜)
        - 무한 루프, 프로세스가 운영체제를 수정하려고 하는 등 프로세스의 문제

## 멀티프로그래밍(일괄 처리Batch System)

한 유저가 CPU와 입출력 장치들이 항상 busy하게 하지는 못한다.

멀티프로그래밍은 작업을 정리해서 CPU가 하나의 작업만 할 수 있게 하는 것.

작업들은 메모리에 계속 유지된다.

작업 스케줄링에 의해 어떤 한 작업이 선택되고, 실행된다.

작업 중 기다려야 하는 경우(입출력이 필요한 상황 등) 운영체제가 다른 작업으로 스위치한다.

## 멀티태스킹 (시분할Timesharing)

Interactive computing

논리적으로는 일괄 처리에서 확장된 개념 - CPU가 작업을 아주 빠르게 스위칭해서 각각의 작업이 진행되는 와중에도 유저가 각각의 작업과 상호작용 할 수 있도록 한다.

- Response time < 1 sec
- 각 유저가 적어도 한 프로그램을 메모리에서 실행시키고 있다.
- 여러 작업이 동시에 실행될 준비가 되면 CPU 스케줄링을 진행한다.
- 프로세스가 메모리에 다 들어가지 못할 때, **스와핑swapping**을 한다.
- **가상메모리Virtual memory** 는 완전히 메모리에 있지 않은 프로세스도 실행할 수 있게끔 되어있다.

## Dual-Mode and Multimode Operation

**Dual-mode** 동작은 운영체제가 자신과 다른 시스템 구성 요소들을 보호하게 해준다.

- **유저 모드User mode**와 **커널 모드Kernel mode**가 있다.

하드웨어에 의해 제공되는 **Mode bit**가 있어서, 시스템이 어떤 모드로 동작하는 중인지 구별한다.

시스템 콜은 모드를 커널 모드로 바꾸고, 이후 return 할 때 모드를 유저 모드로 바꾼다.

몇몇 instructions는 **privileged**로 지정되어서, 커널 모드에서만 실행될 수 있다.

## Timer

타이버는 무한 루프나 프로세스가 자원을 독식하는 것을 방지할 때 쓰인다.

- 타이머는 몇 시간 주기 마다 컴퓨터에게 인터럽트를 보내도록 되어 있다.
- 물리적인 시계에 의해 감소되는 counter을 갖는다.
- 운영체제가 counter을 설정할 수 있다. (이 작업은 privileged instruction이다)
- counter가 0이 되면 인터럽트를 발생시킨다.
- 프로세스 스케줄링을 하기 전에 설정된다.
    - 컨트롤을 다시 되찾기 위해
    - 설정한 시간을 초과한 프로그램을 종료하기 위해

## 프로세스 관리Process Management

**프로세스process**는 실행되는 프로그램을 말한다.

프로세스는 작업을 처리하기 위해 다음 자원들이 필요하다.

- CPU, 메모리, 입출력, 파일
- 초기 데이터

프로세스를 종료하는 것은 재사용가능한 자원을 돌려주는 것

**싱글스레드Single-threaded** 프로세스는 하나의 **program counter**을 갖고, 다음 실행될 instruction의 위치를 특정한다.

- 프로세스는 instruction을 순차적으로 한번에 하나씩 완료될 때까지 실행한다.

**멀티스레드Multi-threaded** 프로세스는 스레드 당 하나의 program counter을 갖는다.

일반적으로 시스템은 많은 프로세스와 몇몇 유저, 몇몇 운영체제를 하나 또는 여러 CPU에서 동시에 실행한다.

- 프로세스/스레드들 간 CPU 다중화를 통해 동시성을 유지한다.

**프로세스 관리 - 운영체제의 동작**

운영체제는 프로세스 관리를 위해 다음과 같은 동작에 대한 책임을 갖는다.

- 유저와 시스템 프로세스를 생성하고 삭제한다.
- 프로세스를 중단하고 재개한다.
- 프로세스 동기화에 대한 메커니즘을 제공한다.
- 프로세스 간 통신에 대한 메커니즘을 제공한다.
- **데드락deadlock** 핸들링 메커니즘을 제공한다.

## 메모리 관리Memory Management

프로그램을 실행하기 위해서는 instruction들이 메모리에 있어야 한다.

프로그램 실행에 필요한 모든 데이터들이 메모리에 있어야 한다.

메모리 관리는 메모리에 어떤 것들이 있을 지 결정하는 것이다.

- CPU 사용이나, 유저에 대한 computer response를 최적화하기 위해!

메모리 관리에는 다음과 같은 동작이 있다.

- 메모리의 어떤 부분이 누구에게 사용되고 있는지 계속 추적한다.
- 어떤 프로세스와 데이터가 메모리에 들어가고 나갈 것인지 결정한다.
- 메모리 공간을 필요에 의해 할당하고 해제한다.
- 

## 저장소 관리Storage Management

### **파일시스템 관리File-system Management**

운영체제는 저장 공간에 대해 최적화된, 논리적인 뷰를 제공한다.

- **파일file** 이라는 것으로 물리적인 속성을 논리적인 저장 유닛으로 추상화 한다.
- 각각의 매체는 장치에 의해 조절된다. (디스크 드라이브, …)
    - 액세스 속도나 용량, 데이터 전송 속도, 접근 방법(순차적이거나 랜덤) 등등의 속성들이 다양하다.

파일시스템 관리에서 보통

- 파일은 주로 **디렉토리directory** 안에 정리된다.
- 접근 권한을 지정해서 누가 어떤 것에 접근할 수 있는 지 정한다.

다음과 같은 운영체제 동작이 포함된다.

- 파일과 디렉토리를 생성하고 삭제하는 것
- 파일과 디렉토리를 다루기 위한 Primitives(기본적인 동작들)
- 파일을 secondary storage에 매핑하는 것
- 파일을 안정적인 (비휘발성) 저장 매체에 백업하는 것

### **대용량 저장소 관리Mass-Storage Management**

주로 디스크는 메인 메모리에 들어갈 수 없는 크기의 데이터를 저장하거나, 오랜 시간 동안 유지될 데이터를 보관하는 데 사용된다.

‘적절한 관리’가 중요한 영역

모든 컴퓨터 동작의 속도는 디스크 하위 시스템과 그 알고리즘에 달려있다.

다음과 같은 운영체제 동작이 포함된다.

- 마운트Mount 와 언마운트Unmount
    - 저장 공간을 인식해서 디렉터리 구조에 편입 시키는 것이다.
- 여유 공간 관리
- 스토리지 할당
- 디스크 스케줄링
- 분할Partitioning
- 보호

### **캐싱Caching**

컴퓨터의 많은 단계에서 사용되는 중요한 원리

정보를 느린 저장 공간에서, 빠른 저장 공간으로 일시적으로 복사하는 것

**과정**

- 빠른 저장 공간(캐시라고 부름)을 들러서 정보가 있는 지 확인한다.
    - 있으면, 캐시에서 직접적으로 정보를 사용할 수 있다. (빠름)
    - 없으면, 데이터를 캐시로 복사해서 사용한다.

멀티태스킹 환경의 경우 캐싱을 이용하게 되면 값이 어떤 저장 공간에 있던 간에 가장 최근의 값을 사용하도록 조심해야 한다!

멀티프로세서 환경은 여러 CPU가 캐시에서 가장 최근의 값을 사용할 수 있도록 하드웨어 면에서 **캐시 일관성cache coherency**을 제공해야 한다.

분산 환경의 경우 더 복잡해진다…

### 입출력 하위시스템I/O Subsystem

운영체제의 또 하나의 목적은 사용자에게 하드웨어 장치의 특성을 숨기는 것이다.

입출력 하위시스템은 다음을 담당한다.

- 입출력에 관한 메모리 관리
    - 버퍼링buffering (전송되는 데이터를 잠시 버퍼에 저장해 두는 것)
    - 캐싱caching (성능을 위해 데이터의 부분을 빠른 저장 공간에 저장해 두는 것)
    - 스풀링spooling (CPU와 입출력 장치가 독립적으로 동작하도록 함, 한 작업의 출력이 진행될 때 다른 작업의 입력을 디스크에 저장해두는 것)
- 일반적인 장치 드라이버의 인터페이스
- 구체적인 하드웨어 장치들에 대한 드라이버

## Protection and Security

Protection은 운영체제가 정의한 자원들에 대한 프로세스나 유저의 접근을 통제하는 것.

Security는 내/외부적인 공격으로부터 시스템을 방어하는 것.

- 서비스 거부DOS, 웜, 바이러스, 신원 도용identity theft, 서비스 도용

시스템은 일반적으로 유저를 구분하고, 누가 무엇을 할 수 있는지 결정한다.

- User identity (**user ID**) : 이름과 특정한 번호를 포함한다. 한 유저 당 하나
- 접근 제어를 위해, User ID는 해당 User가 가진 모든 파일/프로세스들과 연결된다.
- Group identifier (**group ID**) : 유저 집합을 정의하고, 제어를 관리하고 마찬가지로 각 프로세스, 파일과 연결된다.
- **권한 확대Privilege escalation** : /* 권한을 여러 층으로 나누고, 유저가 더 많은 권한을 가진 유효한 ID로 바꿀 수 있게 된다. */

## 가상화Virtualization

운영체제가 다른 OS 내에서 애플리케이션을 실행할 수 있게 해준다.

CPU 종류가 다를 경우 **에뮬레이션Emulation**이 사용된다. 

- 보통 느림
- 언어가 네이티브 코드로 바뀌지 않을 경우 **인터프리트Interpretation**.

가상화는 CPU를 위해 컴파일 된 운영체제가 컴파일 된 게스트 운영체제를 실행하는 것을 말한다.

- 가상머신매니저VMM가 가상화 서비스를 제공한다.

## 분산 시스템Distributed Systems

네트워크로 연결된 분리된 다른 종류의 시스템 모음

- 

## 컴퓨터 시스템 아키텍쳐

많은 시스템들은 단일 일반 목적 프로세서를 사용한다.

- 많은 시스템들은 특수 목적 프로세서들을 사용하기도 한다.

### **멀티프로세서Multiprocessors 시스템**

- 병렬 시스템, 강결합 시스템이라고도 한다.
- 장점은
    - 처리량 증가
    - 규모의 경제 (평균 비용의 감소)
    - 신뢰 증가 - 점진적 성능 저하graceful degradation, 결함 감내fault tolerance
- 두 가지 종류가 있다
    - 비대칭형 멀티프로세싱Asymmetric Multiprocessing : 각 프로세서 마다 특정한 작업이 지정된다.
    - 대칭형 멀티프로세싱Symmetric Multiprocessing : 각 프로세서가 모든 작업을 같이 한다.

**듀얼 코어 디자인**

- 여러 칩과 멀티 코어multicore
- 시스템이 모든 칩을 소유하고 있다.
    - 분리된 시스템 마다 캐시가 있다. - L1 cache,(프로세서 안) L2 cache(코어 안)

**NUMA (Non-Uniform Memory Access System)**

- 멀티프로세서 시스템에서, 각 프로세서는 자신의 메모리에도, 다른 프로세서의 메모리에도 접근한다.
- 당연히 각 프로세서가 자신의 로컬 메모리에 접근하는 속도가 가장 빠르다.
- 이렇게 메모리에 접근하는 시간이 CPU와 메모리의 상대적인 위치에 따라 달라지는 컴퓨터 메모리 설계 방법

### 클러스터 시스템Clustered Systems

멀티프로세서 시스템처럼, 여러 시스템들이 같이 일하는 것.

- 주로 저장 공간을 공유한다.
- 높은 가용성의 서비스를 제공한다.
    - 비대칭형 클러스터링의 경우 한 머신이 상시 대기hot-standby 모드에 있는다.
    - 대칭형 클러스터링의 경우 여러 노드가 애플리케이션을 실행하며, 서로를 모니터링한다.
- 고성능컴퓨팅(HPC, high-performance computing)을 목적으로 하는 경우도 있다.
- 작업의 충돌을 막기 위해 분산 락 매니저(DLM, distributed lock manager)를 가질 수 있다.

## 컴퓨터 시스템 환경

### Traditional

- 단일, 다목적
- 많은 시스템이 서로 연결된 구조
- 포탈Portals이 내부 시스템에 웹 엑세스를 제고
- 네트워크 컴퓨터는 웹 터미널 같음
- 모바일 컴퓨터는 무선 네트워크를 통해 통신
- 유비쿼터스(어디서든 통신이 가능한 세상), 방화벽이 생김

### 모바일

- 스마트폰, 태블릿, …
- 더 많은 운영체제의 기능 (GPS, 자이로스코프)
- 증강 현실과 같은 새로운 종류의 애플리케이션 등장
- IEEE 802.11 (WiFi)나 셀룰러 데이터 네트워크를 사용
- 대표적으로 Apple iOS와 Google Android

### 클라이언트 서버 컴퓨팅

- 바보였던 터미널이 똑똑한 PC로 대체됨
- 서버 시스템이 클라이언트의 요청에 응답함
    - 서버 기반 컴퓨팅  - 클라이언트에 서비스를 요청할 인터페이스가 제공됨
    - 파일 서버 시스템 - 클라이언트가 파일을 저장하고 되찾을 인터페이스가 제공됨

### Peer-to-Peer (P2P)

- 분산 시스템의 또 다른 모델
- P2P는 클라이언트와 서버의 구분이 없음
    - 모든 노드는 peer
    - 각각이 client, server의 역할을 할 수 있음
    - 노드는 P2P 네트워크에 join해야 함
        - 네트워크 중앙의 lookup service에 register하는 방식이거나
        - Discovery protocol을 통해 request를 broadcast 하거나, request에 respond하는 방식일 수 있음
    - Ex) Napster, Gnutella, VoIP like Skype

### 클라우드 컴퓨팅Cloud Computing

- 네트워크를 통해 컴퓨팅이나 저장 공간, 애플리케이션을 서비스로 제공함
- 가상화의 논리적인 확장임
    - Ex) 아마존 EC2
- 많은 종류가 있음
    - Public cloud - 인터넷을 통해 누구나 접근 가능
    - Private cloud - 회사 내 사용을 위해 회사에 의해 운영됨
    - Hybrid cloud - 위 두 가지 클라우드 요소를 포함함
    - SaaS (Software as a Service) - 애플리케이션을 제공
    - PaaS (Platform as a Service) - 애플리케이션을 위한 소프트웨어 스택이 준비됨
    - IaaS (Infrastructure as a Service) - 서버나 저장 공간이 준비됨
        - SaaS, PaaS, IaaS 각각 아래에서 어떤 부분을 포함할 지 생각해보면 좋음
            
            Application
            
            Data
            
            Runtime
            
            Middleware
            
            OS
            
            Virtualization
            
            Server
            
            Storage
            
            Network
            
- 클라우드 컴퓨팅 환경은 전통적인 운영체제와, VMM(가상환경 매니저), 클라우드 관리 툴로 이루어짐
    - 인터넷 연결은 방화벽 같은 보안이 필요함
    - **로드 밸런서Load balancer**가 트래픽을 여러 애플리케이션 사이에서 조절함

### 실시간 임베디드 시스템

- 실시간 임베디드 시스템은 가장 널리 퍼진 형태
    - 다양함
- 실시간 운영체제는 시간 제약constraint이 잘 정해져 있어야 함
- 프로세싱은 시간 제약 안에 끝나야 함
- 제약 조건을 만족한 경우에만 올바르게 작동함

## 커널 자료구조

Singly linked list, Doubly linked list, Circular linked list, Binary search tree, Hash map 등을 사용함

리눅스 <linux/list.h> <linux/kfifo.h> <linux/rbtree.h> 등등 있음